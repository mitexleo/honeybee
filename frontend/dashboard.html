<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Nextcloud Honeypot Dashboard</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                background: #f5f5f5;
                color: #333;
            }

            /* Login Modal Styles */
            .login-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            }

            .login-modal.hidden {
                display: none;
            }

            .login-box {
                background: white;
                padding: 40px;
                border-radius: 12px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                width: 100%;
                max-width: 400px;
                text-align: center;
            }

            .login-box h2 {
                margin-bottom: 30px;
                color: #0082c9;
                font-size: 24px;
            }

            .form-group {
                margin-bottom: 20px;
                text-align: left;
            }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: #555;
            }

            .form-group input {
                width: 100%;
                padding: 12px;
                border: 2px solid #ddd;
                border-radius: 6px;
                font-size: 16px;
                transition: border-color 0.3s;
            }

            .form-group input:focus {
                outline: none;
                border-color: #0082c9;
            }

            .login-button {
                width: 100%;
                padding: 14px;
                background: linear-gradient(135deg, #0082c9 0%, #006ba8 100%);
                color: white;
                border: none;
                border-radius: 6px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: transform 0.2s;
            }

            .login-button:hover {
                transform: translateY(-2px);
            }

            .login-button:disabled {
                opacity: 0.7;
                cursor: not-allowed;
                transform: none;
            }

            .error-message {
                color: #e74c3c;
                background: #fdf2f2;
                padding: 12px;
                border-radius: 6px;
                margin-bottom: 20px;
                display: none;
                font-size: 14px;
            }

            .loading-spinner {
                display: inline-block;
                width: 16px;
                height: 16px;
                border: 2px solid #ffffff;
                border-radius: 50%;
                border-top-color: transparent;
                animation: spin 1s linear infinite;
                margin-left: 10px;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .header {
                background: linear-gradient(135deg, #0082c9 0%, #006ba8 100%);
                color: white;
                padding: 20px 0;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }

            .header h1 {
                font-size: 28px;
                font-weight: 700;
                margin-bottom: 5px;
            }

            .header p {
                opacity: 0.9;
                font-size: 16px;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 20px;
            }

            .main-content {
                padding: 30px 20px;
                max-width: 1400px;
                margin: 0 auto;
            }

            .alert {
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                color: #856404;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 30px;
                border-left: 4px solid #ffc107;
            }

            .alert-danger {
                background: #f8d7da;
                border-color: #f5c6cb;
                color: #721c24;
                border-left-color: #dc3545;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .stat-card {
                background: white;
                padding: 25px;
                border-radius: 12px;
                text-align: center;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                transition: transform 0.2s ease;
            }

            .stat-card:hover {
                transform: translateY(-2px);
            }

            .stat-number {
                font-size: 2.5em;
                font-weight: 800;
                color: #dc3545;
                margin-bottom: 8px;
            }

            .stat-label {
                font-size: 14px;
                color: #666;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 600;
            }

            .card {
                background: white;
                border-radius: 12px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                margin-bottom: 30px;
                overflow: hidden;
            }

            .card-header {
                background: #f8f9fa;
                padding: 20px;
                border-bottom: 1px solid #dee2e6;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .card-title {
                font-size: 18px;
                font-weight: 600;
                color: #333;
            }

            .card-body {
                padding: 20px;
            }

            .export-section {
                background: linear-gradient(135deg, #e8f4fd 0%, #d4f1f4 100%);
                padding: 25px;
                border-radius: 12px;
                margin-bottom: 30px;
                border: 1px solid rgba(0, 130, 201, 0.2);
            }

            .export-buttons {
                display: flex;
                gap: 12px;
                flex-wrap: wrap;
                margin-top: 15px;
            }

            .btn {
                padding: 12px 24px;
                text-decoration: none;
                border-radius: 8px;
                font-weight: 600;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                transition: all 0.2s ease;
                border: none;
                cursor: pointer;
                font-size: 14px;
            }

            .btn-primary {
                background: #0082c9;
                color: white;
            }

            .btn-success {
                background: #28a745;
                color: white;
            }

            .btn-warning {
                background: #ffc107;
                color: #333;
            }

            .btn-secondary {
                background: #6c757d;
                color: white;
            }

            .btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            }

            .table-container {
                max-height: 600px;
                overflow: auto;
                border: 1px solid #dee2e6;
                border-radius: 8px;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 13px;
            }

            th {
                background: #f8f9fa;
                padding: 12px 8px;
                text-align: left;
                font-weight: 600;
                border-bottom: 2px solid #dee2e6;
                position: sticky;
                top: 0;
                z-index: 10;
            }

            td {
                padding: 10px 8px;
                border-bottom: 1px solid #dee2e6;
                vertical-align: top;
            }

            tr:hover {
                background: #f8f9fa;
            }

            .danger-row {
                background: rgba(220, 53, 69, 0.05);
            }

            .timestamp {
                font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
                font-size: 11px;
                color: #666;
            }

            .ip-address {
                font-weight: 700;
                color: #dc3545;
                font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
            }

            .username {
                font-weight: 700;
                color: #6f42c1;
                font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
            }

            .password {
                font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
                background: #f8f9fa;
                padding: 4px 6px;
                border-radius: 4px;
                border: 1px solid #dee2e6;
                font-size: 12px;
            }

            .badge {
                background: #dc3545;
                color: white;
                padding: 3px 8px;
                border-radius: 12px;
                font-size: 11px;
                font-weight: 600;
            }

            .badge-warning {
                background: #ffc107;
                color: #333;
            }

            .badge-info {
                background: #17a2b8;
                color: white;
            }

            .truncate {
                max-width: 200px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .pagination {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-top: 20px;
            }

            .pagination a {
                padding: 8px 16px;
                text-decoration: none;
                border: 1px solid #dee2e6;
                border-radius: 6px;
                color: #0082c9;
                transition: all 0.2s ease;
            }

            .pagination a:hover {
                background: #0082c9;
                color: white;
            }

            .pagination .current {
                background: #0082c9;
                color: white;
                border-color: #0082c9;
            }

            .refresh-btn {
                position: fixed;
                bottom: 30px;
                right: 30px;
                width: 60px;
                height: 60px;
                background: #0082c9;
                color: white;
                border: none;
                border-radius: 50%;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
            }

            .refresh-btn:hover {
                background: #006ba8;
                transform: scale(1.1);
            }

            .loading {
                text-align: center;
                padding: 40px;
                color: #666;
            }

            .loading::after {
                content: "";
                width: 40px;
                height: 40px;
                margin: 20px auto;
                border: 4px solid #f3f3f3;
                border-top: 4px solid #0082c9;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                display: block;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            @media (max-width: 768px) {
                .stats-grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 15px;
                }

                .export-buttons {
                    flex-direction: column;
                }

                .btn {
                    justify-content: center;
                }

                .table-container {
                    font-size: 12px;
                }

                th,
                td {
                    padding: 8px 4px;
                }
            }
        </style>
    </head>
    <body>
        <!-- Login Modal -->
        <div id="loginModal" class="login-modal">
            <div class="login-box">
                <h2>Admin Login</h2>
                <div
                    id="error-message"
                    class="error-message"
                    style="display: none"
                ></div>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input
                            type="text"
                            id="username"
                            name="username"
                            required
                            autocomplete="username"
                        />
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            required
                            autocomplete="current-password"
                        />
                    </div>
                    <button
                        type="submit"
                        id="submit-button"
                        class="login-button"
                    >
                        <span>Login</span>
                        <div
                            id="loading-spinner"
                            class="loading-spinner"
                            style="display: none"
                        ></div>
                    </button>
                </form>
            </div>
        </div>

        <div class="header">
            <div class="container">
                <h1>Nextcloud Honeypot Dashboard</h1>
                <p>Monitor and analyze attack attempts in real-time</p>
            </div>
        </div>

        <div class="main-content">
            <div id="loading" class="loading">Loading dashboard data...</div>

            <div id="dashboard-content" style="display: none">
                <!-- Stats will be populated by JavaScript -->
                <div class="stats-grid" id="stats-grid"></div>

                <!-- Export Section -->
                <div class="export-section">
                    <h3 style="margin-bottom: 10px">📥 Export Attack Data</h3>
                    <p>
                        Download comprehensive attack intelligence and forensic
                        data in multiple formats:
                    </p>
                    <div class="export-buttons">
                        <a
                            href="#"
                            onclick="exportData('all', 'csv')"
                            class="btn btn-success"
                        >
                            📊 Download All Data (ZIP)
                        </a>
                        <a
                            href="#"
                            onclick="exportData('login', 'csv')"
                            class="btn btn-primary"
                        >
                            🔐 Login Attempts (CSV)
                        </a>
                        <a
                            href="#"
                            onclick="exportData('register', 'csv')"
                            class="btn btn-warning"
                        >
                            📝 Registration Attempts (CSV)
                        </a>
                        <a
                            href="#"
                            onclick="exportData('sessions', 'csv')"
                            class="btn btn-secondary"
                        >
                            👤 Sessions (CSV)
                        </a>
                        <a
                            href="#"
                            onclick="exportData('all', 'json')"
                            class="btn btn-primary"
                        >
                            📄 JSON Export
                        </a>
                    </div>
                </div>

                <!-- Top Attacking IPs -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            🚨 Top Attacking IPs (Last 7 Days)
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="top-ips-table">
                                <thead>
                                    <tr>
                                        <th>IP Address</th>
                                        <th>Attempts</th>
                                        <th>Country</th>
                                        <th>City</th>
                                        <th>Threat Level</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Recent Login Attempts -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">🔐 Recent Login Attempts</h3>
                        <span class="badge" id="login-count">0</span>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="login-attempts-table">
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>IP Address</th>
                                        <th>Username</th>
                                        <th>Password</th>
                                        <th>Session ID</th>
                                        <th>Attempts</th>
                                        <th>User Agent</th>
                                        <th>Country</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Recent Registration Attempts -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            📝 Recent Registration Attempts
                        </h3>
                        <span class="badge" id="register-count">0</span>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="registration-attempts-table">
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>IP Address</th>
                                        <th>Full Name</th>
                                        <th>Email</th>
                                        <th>Username</th>
                                        <th>Password</th>
                                        <th>Session ID</th>
                                        <th>Country</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Security Notice -->
                <div class="alert alert-danger">
                    <strong>⚠️ SECURITY NOTICE:</strong> This is a honeypot
                    system designed to detect and analyze malicious activity.
                    All interactions are logged and analyzed for security
                    research purposes. If you are viewing this dashboard, ensure
                    you have proper authorization to access this system.
                </div>
            </div>
        </div>

        <button
            class="refresh-btn"
            onclick="refreshDashboard()"
            title="Refresh Dashboard"
        >
            🔄
        </button>

        <script>
            // Dashboard JavaScript
            let refreshInterval;
            let currentData = null;

            // Initialize dashboard
            document.addEventListener("DOMContentLoaded", function () {
                // Authentication is now handled by the login modal
                // The modal will check auth status and load data if authenticated

                // Start loading data if already authenticated
                const token =
                    localStorage.getItem("admin_token") ||
                    getCookie("admin_token");
                if (token) {
                    loadDashboardData();
                }
                // Auto-refresh every 30 seconds
                refreshInterval = setInterval(loadDashboardData, 30000);
            });

            async function loadDashboardData() {
                try {
                    const token = localStorage.getItem("admin_token");
                    const response = await fetch("/admin/api/dashboard", {
                        headers: {
                            Authorization: `Bearer ${token}`,
                        },
                    });
                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    }
                    currentData = await response.json();
                    updateDashboard(currentData);

                    document.getElementById("loading").style.display = "none";
                    document.getElementById("dashboard-content").style.display =
                        "block";
                } catch (error) {
                    console.error("Error loading dashboard data:", error);
                    showError(
                        "Failed to load dashboard data: " + error.message,
                    );
                }
            }

            function updateDashboard(data) {
                updateStats(data.stats);
                updateTopIPs(data.top_ips);
                updateLoginAttempts(data.login_attempts);
                updateRegistrationAttempts(data.registration_attempts);
            }

            function updateStats(stats) {
                const statsGrid = document.getElementById("stats-grid");
                statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.TotalSessions || 0}</div>
                    <div class="stat-label">Total Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.UniqueIPs || 0}</div>
                    <div class="stat-label">Unique IPs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.Countries || 0}</div>
                    <div class="stat-label">Countries</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.RecentSessions || 0}</div>
                    <div class="stat-label">Active (1hr)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.Sessions24h || 0}</div>
                    <div class="stat-label">Sessions (24hr)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.TotalAttacks || 0}</div>
                    <div class="stat-label">Total Attacks</div>
                </div>
            `;
            }

            function updateTopIPs(topIPs) {
                const tbody = document.querySelector("#top-ips-table tbody");
                tbody.innerHTML = "";

                topIPs.forEach((ip) => {
                    const row = document.createElement("tr");
                    row.className = "danger-row";

                    const threatLevel =
                        ip.Attempts > 50
                            ? "Critical"
                            : ip.Attempts > 20
                              ? "High"
                              : "Medium";
                    const threatClass =
                        ip.Attempts > 50
                            ? "badge"
                            : ip.Attempts > 20
                              ? "badge-warning"
                              : "badge-info";

                    row.innerHTML = `
                    <td class="ip-address">${ip.IPAddress}</td>
                    <td><strong>${ip.Attempts}</strong></td>
                    <td>${ip.Country || "Unknown"}</td>
                    <td>${ip.City || "Unknown"}</td>
                    <td><span class="badge ${threatClass}">${threatLevel}</span></td>
                `;
                    tbody.appendChild(row);
                });
            }

            function updateLoginAttempts(loginAttempts) {
                const tbody = document.querySelector(
                    "#login-attempts-table tbody",
                );
                const countBadge = document.getElementById("login-count");

                tbody.innerHTML = "";
                countBadge.textContent = loginAttempts.length;

                loginAttempts.forEach((attempt) => {
                    const row = document.createElement("tr");
                    row.className = "danger-row";

                    row.innerHTML = `
                    <td class="timestamp">${formatTimestamp(attempt.Timestamp)}</td>
                    <td class="ip-address">${attempt.IPAddress}</td>
                    <td class="username">${escapeHtml(attempt.Username || "N/A")}</td>
                    <td class="password">${escapeHtml(attempt.PasswordHash || "N/A")}</td>
                    <td class="truncate" title="${attempt.SessionID}">${attempt.SessionID}</td>
                    <td><strong>${attempt.AttemptNumber}</strong></td>
                    <td class="truncate" title="${escapeHtml(attempt.UserAgent || "")}">${escapeHtml(truncate(attempt.UserAgent || "Unknown", 50))}</td>
                    <td>${attempt.Country || "Unknown"}</td>
                `;
                    tbody.appendChild(row);
                });
            }

            function updateRegistrationAttempts(regAttempts) {
                const tbody = document.querySelector(
                    "#registration-attempts-table tbody",
                );
                const countBadge = document.getElementById("register-count");

                tbody.innerHTML = "";
                countBadge.textContent = regAttempts.length;

                regAttempts.forEach((attempt) => {
                    const row = document.createElement("tr");
                    row.className = "danger-row";

                    row.innerHTML = `
                    <td class="timestamp">${formatTimestamp(attempt.Timestamp)}</td>
                    <td class="ip-address">${attempt.IPAddress}</td>
                    <td class="username">${escapeHtml(attempt.Fullname || "N/A")}</td>
                    <td class="username">${escapeHtml(attempt.Email || "N/A")}</td>
                    <td class="username">${escapeHtml(attempt.Username || "N/A")}</td>
                    <td class="password">${escapeHtml(attempt.PasswordHash || "N/A")}</td>
                    <td class="truncate" title="${attempt.SessionID}">${attempt.SessionID}</td>
                    <td>${attempt.Country || "Unknown"}</td>
                `;
                    tbody.appendChild(row);
                });
            }

            function formatTimestamp(timestamp) {
                const date = new Date(timestamp);
                return date.toLocaleString("en-US", {
                    year: "numeric",
                    month: "2-digit",
                    day: "2-digit",
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit",
                });
            }

            function escapeHtml(text) {
                const div = document.createElement("div");
                div.textContent = text;
                return div.innerHTML;
            }

            function truncate(str, length) {
                return str.length > length
                    ? str.substring(0, length) + "..."
                    : str;
            }

            function refreshDashboard() {
                document.getElementById("loading").style.display = "block";
                document.getElementById("dashboard-content").style.display =
                    "none";
                loadDashboardData();
            }

            function showError(message) {
                document.getElementById("loading").innerHTML = `
                <div style="color: #dc3545; padding: 20px; text-align: center;">
                    <h3>❌ Error</h3>
                    <p>${message}</p>
                    <button onclick="refreshDashboard()" class="btn btn-primary">
                        Try Again
                    </button>
                </div>
            `;
            }

            function exportData(type, format) {
                const token = localStorage.getItem("admin_token");
                let url = `/admin/api/export/${format}`;
                if (format === "csv" && type !== "all") {
                    url += `?type=${type}`;
                }

                // Use fetch with authorization header to download the file
                fetch(url, {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                })
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error(
                                "Export failed: " + response.status,
                            );
                        }
                        return response.blob();
                    })
                    .then((blob) => {
                        const downloadUrl = window.URL.createObjectURL(blob);
                        const a = document.createElement("a");
                        a.style.display = "none";
                        a.href = downloadUrl;
                        a.download = `honeypot_${type}_export.${format === "csv" ? "csv" : "json"}`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(downloadUrl);
                        document.body.removeChild(a);
                    })
                    .catch((error) => {
                        console.error("Export error:", error);
                        alert("Export failed: " + error.message);
                    });
            }

            // Cleanup interval on page unload
            window.addEventListener("beforeunload", function () {
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }
            });

            // Login Modal Functionality
            const loginModal = document.getElementById("loginModal");
            const loginForm = document.getElementById("adminLoginForm");
            const errorMessage = document.getElementById("error-message");
            const loadingSpinner = document.getElementById("loading-spinner");
            const submitButton = document.getElementById("submit-button");
            const usernameInput = document.getElementById("username");

            // Show login modal on page load
            loginModal.classList.remove("hidden");
            usernameInput.focus();

            loginForm.addEventListener("submit", async function (e) {
                e.preventDefault();

                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;

                // Show loading state
                loadingSpinner.style.display = "inline-block";
                submitButton.disabled = true;
                hideMessage(errorMessage);

                try {
                    const response = await fetch("/api/login", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ username, password }),
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // Store token and hide modal
                        localStorage.setItem("admin_token", data.token);
                        document.cookie = `admin_token=${data.token}; max-age=86400; path=/`;
                        loginModal.classList.add("hidden");

                        // Load dashboard data
                        loadDashboardData();
                        refreshInterval = setInterval(loadDashboardData, 30000);
                    } else {
                        showMessage(errorMessage, data.error || "Login failed");
                    }
                } catch (error) {
                    showMessage(
                        errorMessage,
                        "Network error. Please try again.",
                    );
                } finally {
                    loadingSpinner.style.display = "none";
                    submitButton.disabled = false;
                }
            });

            function showMessage(element, message) {
                element.textContent = message;
                element.style.display = "block";
            }

            function hideMessage(element) {
                element.style.display = "none";
            }

            // Check if already logged in (token in localStorage or cookie)
            function checkAuth() {
                const token =
                    localStorage.getItem("admin_token") ||
                    getCookie("admin_token");
                if (token) {
                    // Verify token is still valid
                    fetch("/admin/api/dashboard", {
                        headers: {
                            Authorization: `Bearer ${token}`,
                        },
                    })
                        .then((response) => {
                            if (response.ok) {
                                loginModal.classList.add("hidden");
                                loadDashboardData();
                                refreshInterval = setInterval(
                                    loadDashboardData,
                                    30000,
                                );
                            } else {
                                // Token invalid, show login
                                localStorage.removeItem("admin_token");
                                document.cookie =
                                    "admin_token=; max-age=0; path=/";
                                loginModal.classList.remove("hidden");
                            }
                        })
                        .catch(() => {
                            loginModal.classList.remove("hidden");
                        });
                } else {
                    loginModal.classList.remove("hidden");
                }
            }

            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(";").shift();
            }

            // Check authentication on page load
            checkAuth();
        </script>
    </body>
</html>
